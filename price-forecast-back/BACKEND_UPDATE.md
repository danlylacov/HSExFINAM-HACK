# Обновление бэкенда на основе новой модели из Untitled11.ipynb

## Основные изменения

### 1. Улучшенная инженерия признаков
- **Новая функция `create_advanced_momentum_features()`**:
  - Разностные признаки вместо процентных изменений
  - Нормализованные изменения и трендовые признаки
  - Объемные признаки с нормализацией
  - Технические индикаторы с нормализацией (RSI, MACD)
  - Временные признаки (день недели, месяц)
  - Волатильностные кластеры

### 2. Новая архитектура модели
- **`HistGradientBoostingRegressor`** вместо обычного GradientBoostingRegressor
- **`RobustScaler`** вместо StandardScaler для устойчивости к выбросам
- **Сбалансированная модель** с регуляризацией смещения

### 3. Предсказание доходностей
- Модель теперь предсказывает **доходности**, а не прямые цены
- Регуляризация предсказаний для предотвращения экстремальных значений
- Коррекция смещения и сглаживание предсказаний

### 4. Улучшенный пайплайн обучения
- Консервативное заполнение пропусков
- Ограничение выбросов в целевой переменной (5% и 95% квантили)
- Приоритизация признаков по категориям
- Ограничение общего количества признаков

### 5. Совместимость API
- **Структура запросов осталась неизменной**
- Все эндпоинты работают как прежде
- Формат ответов сохранен
- Обратная совместимость с существующими клиентами

## Ключевые функции

### `create_advanced_momentum_features(df)`
Создает улучшенные признаки на основе ценовых данных, объемов, технических индикаторов и новостных данных.

### `create_balanced_return_model(X_train, y_train)`
Создает сбалансированную модель с регуляризацией для предсказания доходностей.

### `predict_single_candle(input_data)`
Предсказывает одну свечу с использованием новой модели доходностей и регуляризации.

## Тестирование

Запустите тест для проверки нового бэкенда:
```bash
python3 test_new_backend.py
```

## Преимущества новой модели

1. **Лучшая точность**: Предсказание доходностей более стабильно
2. **Регуляризация**: Предотвращение экстремальных предсказаний
3. **Улучшенные признаки**: Более информативные признаки для модели
4. **Устойчивость к выбросам**: RobustScaler и ограничения
5. **Совместимость**: API остается неизменным

## Структура файлов

- `main.py` - обновленный бэкенд с новой моделью
- `test_new_backend.py` - тест для проверки работы
- `models/` - папка с обученными моделями
- `data/` - папка с данными для обучения

