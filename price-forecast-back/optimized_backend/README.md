# Оптимизированный бэкенд для предсказания цен

## Описание

Этот бэкенд реализует оптимизированную модель предсказания цен на основе доходностей с использованием улучшенной инженерии признаков и регуляризации.

## Особенности

- **Предсказание доходностей**: Модель предсказывает доходности вместо прямых цен
- **Улучшенные признаки**: Разностные признаки, нормализация, трендовые индикаторы
- **Регуляризация**: Ограничение экстремальных предсказаний
- **RobustScaler**: Устойчивость к выбросам
- **Ансамбль моделей**: VotingRegressor с HistGradientBoostingRegressor

## Установка

```bash
pip install -r requirements.txt
```

## Запуск

```bash
python main.py
```

Сервер запустится на порту 8010.

## API Эндпоинты

### Основные

- `GET /` - Информация о API
- `GET /health` - Проверка здоровья сервера
- `POST /predict` - Предсказание 20 свечей

### Обучение

- `POST /upload-data` - Загрузка данных для обучения
- `POST /train` - Обучение модели
- `GET /training-config` - Конфигурация обучения
- `GET /data-files` - Список загруженных файлов

## Формат запроса для предсказания

```json
{
  "params": [
    {
      "ticker": "AFLT",
      "date": "2025-01-01",
      "nn_news_sum": 1.2,
      "nn_news_mean": 0.03,
      "nn_news_max": 0.18,
      "nn_news_count": 43,
      "sentiment_mean": 0.5,
      "sentiment_sum": 20.0,
      "sentiment_count": 40,
      "sentiment_positive_count": 20,
      "sentiment_negative_count": 10,
      "sentiment_neutral_count": 10,
      "rsi": 50.0,
      "macd": 0.5,
      "cci": 0.0,
      "ema9": 100.0,
      "ema50": 100.0,
      "areThreeWhiteSoldiers": 0,
      "areThreeBlackCrows": 0,
      "doji": 0,
      "bearishEngulfing": 0,
      "bullishEngulfing": 0,
      "open": 100.0,
      "high": 105.0,
      "low": 95.0,
      "close": 102.0,
      "volume": 1000000
    }
  ]
}
```

## Обучение модели

1. Загрузите данные через `/upload-data`
2. Обучите модель через `/train` с конфигурацией:

```json
{
  "train_size": 25,
  "test_size": null
}
```

## Структура проекта

```
optimized_backend/
├── main.py              # Основной файл API
├── requirements.txt     # Зависимости
├── README.md           # Документация
├── models/             # Папка для обученных моделей
└── data/               # Папка для данных
```

## Тестирование

```bash
python test_api.py
```

## Отличия от базовой версии

1. **Единая модель**: Одна оптимизированная модель вместо 5 отдельных
2. **Предсказание доходностей**: Более стабильные предсказания
3. **Улучшенные признаки**: Более информативные признаки
4. **Регуляризация**: Предотвращение экстремальных предсказаний
5. **RobustScaler**: Устойчивость к выбросам
6. **Метрики соревнования**: Оценка по MAE, Brier Score, Directional Accuracy
